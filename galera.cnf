[mysqld]
# 기본 MySQL 설정
binlog_format=ROW
default-storage-engine=innodb
innodb_autoinc_lock_mode=2
bind-address=0.0.0.0
innodb_buffer_pool_load_at_startup=OFF
innodb_buffer_pool_dump_at_shutdown=OFF
performance_schema=OFF

# Galera Provider 설정
wsrep_on=ON
wsrep_provider=/usr/lib/galera/libgalera_smm.so
wsrep_provider_options="gcache.size=1G;gcs.fc_limit=128;gcs.fc_factor=0.8"

# Cluster 설정
wsrep_cluster_name="galera_cluster"
wsrep_cluster_address="gcomm://mariadb1,mariadb2,mariadb3"

# State Transfer 설정
wsrep_sst_method=mariabackup
wsrep_sst_auth=sst_user:sst_password

# 노드 설정
wsrep_node_address="mariadb1"
wsrep_node_name="mariadb1"

# 복제 및 일관성 설정
wsrep_sync_wait=1
wsrep_retry_autocommit=3
wsrep_max_ws_rows=131072
wsrep_max_ws_size=1G
wsrep_load_data_splitting=ON

# InnoDB 설정
innodb_flush_log_at_trx_commit=1
innodb_buffer_pool_size=4G
innodb_log_file_size=1G
innodb_file_per_table=ON
innodb_flush_method=O_DIRECT
innodb_io_capacity=1000
innodb_io_capacity_max=2000

# 성능 최적화
innodb_flush_neighbors=0
innodb_read_io_threads=8
innodb_write_io_threads=8
innodb_doublewrite=1

# 보안 설정
skip_name_resolve
max_connections=1000
max_allowed_packet=64M

# 로깅 설정
log_error=/var/log/mysql/error.log
slow_query_log=1
slow_query_log_file=/var/log/mysql/slow.log
long_query_time=2